<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Активация Email — EasyLink</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="style.css"></noscript>
    <link rel="icon" href="http://localhost/favicon.ico">
    <meta property="og:title" content="EasyLink - Сервис сокращения ссылок">
    <meta property="og:description" content="Easylink - современный сервис сокращения ссылок">
    <meta property="og:image" content="http://localhost/api/urls/static/easylink-preview.png">
    <meta property="og:url" content="http://localhost/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="EasyLink">
    <style>
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
        margin: 0;
        background: linear-gradient(135deg, #18181b 0%, #0f0f11 50%, #1f1f23 100%);
        min-height: 100vh;
        color: #f4f4f5;
      }
      .spinner { animation: spin 1s linear infinite; }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      .gradient-text {
        background: linear-gradient(45deg, #6366f1, #a855f7, #3b82f6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .loading { opacity: 0; }
      .loaded { opacity: 1; transition: opacity 0.3s ease; }
    </style>
</head>
<body class="loading">
  <header class="sticky top-0 z-50 bg-zinc-900/95 backdrop-blur-md border-b border-zinc-800/50">
    <div class="max-w-7xl mx-auto flex items-center px-8 py-4" style="padding-top: 20px; padding-bottom: 20px; margin-left: 21.5px;">
      <div class="flex items-center space-x-3 cursor-pointer" onclick="window.location.href='index.html'">
        <div class="bg-indigo-600 rounded-xl w-10 h-10 flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
        </div>
        <span class="text-2xl font-bold tracking-wide text-indigo-300">EasyLink</span>
        <div class="hidden lg:block ml-4 px-2 py-1 bg-indigo-500/20 rounded-lg">
          <span class="text-xs text-indigo-300 font-semibold">BETA</span>
        </div>
      </div>
    </div>
  </header>

  <main class="flex-1 flex items-center justify-center px-4 py-12 fade-in">
    <div class="w-full max-w-md bg-zinc-900/90 rounded-2xl shadow-2xl border border-zinc-800 p-8 flex flex-col items-center">
      <div id="loading-state">
        <div class="w-16 h-16 bg-indigo-500/20 rounded-2xl flex items-center justify-center mb-6 relative mx-auto">
          <svg class="w-10 h-10 text-indigo-400 animate-spin absolute inset-0 m-auto opacity-60" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-indigo-300 mb-2 text-center">Активация Email</h1>
        <p class="text-zinc-400 text-center mb-6">Проверяем ваш токен активации...</p>
      </div>
      <div id="success-state" style="display: none;">
        <div class="w-16 h-16 bg-emerald-500/20 rounded-2xl flex items-center justify-center mb-6 mx-auto">
          <svg class="w-10 h-10 text-emerald-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-emerald-300 mb-2 text-center">Email подтверждён!</h1>
        <p class="text-zinc-400 text-center mb-6">Ваш email успешно активирован.<br>Теперь вы можете в полной мере пользоваться EasyLink.</p>
        <a href="/" class="bg-indigo-600 hover:bg-indigo-700 transition-all text-white text-lg px-8 py-4 rounded-xl font-semibold shadow-md active:scale-95 flex items-center justify-center gap-2 mt-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
          </svg>
          Войти в систему
        </a>
      </div>
      <div id="error-state" style="display: none;">
        <div class="w-16 h-16 bg-red-500/20 rounded-2xl flex items-center justify-center mb-6 mx-auto">
          <svg class="w-10 h-10 text-red-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <h1 id="error-title" class="text-2xl font-bold text-red-300 mb-2 text-center">Ошибка активации</h1>
        <p id="error-message" class="text-zinc-400 text-center mb-6">Произошла ошибка при активации email.</p>
        <a href="/" class="bg-zinc-800 hover:bg-zinc-700 transition-all text-zinc-200 text-lg px-8 py-4 rounded-xl font-semibold shadow-md active:scale-95 flex items-center justify-center gap-2 mt-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Вернуться на главную
        </a>
      </div>
    </div>
  </main>

  <footer style="padding: 32px 0; text-align: center; color: #71717a; font-size: 14px;">
    <p>Нужна помощь? Свяжитесь с <a href="#" style="color: #a5b4fc; text-decoration: none;">поддержкой</a></p>
  </footer>
  <script src="script.js"></script>
  <script>
    document.body.classList.remove('loading');
    document.body.classList.add('loaded');

    function getToken() {
      const params = new URLSearchParams(window.location.search);
      return params.get('token');
    }

    function showSuccess() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('success-state').style.display = 'block';
      document.getElementById('error-state').style.display = 'none';
    }

    function showError(title, message) {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('success-state').style.display = 'none';
      document.getElementById('error-state').style.display = 'block';
      document.getElementById('error-title').textContent = title;
      document.getElementById('error-message').textContent = message;
    }

    async function activateEmail() {
      const token = getToken();
      if (!token) {
        showError('Токен не найден', 'Ссылка активации повреждена или неполная.');
        return;
      }
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout
        const res = await fetch(`http://localhost/api/users/activate-email?token=${encodeURIComponent(token)}`, {
          signal: controller.signal
        });
        clearTimeout(timeoutId);
        if (res.status === 200) {
          showSuccess();
        } else if (res.status === 400) {
          showError('Токен недействителен', 'Ссылка активации истекла или была использована.');
        } else if (res.status === 404) {
          showError('Пользователь не найден', 'Аккаунт с указанным email не существует в системе.');
        } else {
          showError('Ошибка сервера', 'Произошла временная ошибка. Попробуйте повторить попытку через несколько минут.');
        }
      } catch (e) {
        if (e.name === 'AbortError') {
          showError('Тайм-аут', 'Сервер слишком долго отвечает. Попробуйте позже.');
        } else {
          showError('Нет подключения', 'Не удалось связаться с сервером. Проверьте подключение к интернету.');
        }
      }
    }

    activateEmail();
  </script>

</body>
</html>
